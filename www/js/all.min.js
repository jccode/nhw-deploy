;(function(a){var b={CURR_USER:'KEY_LOCAL_CURR_USER',USER_DATA:'KEY_LOCAL_USER_DATA',LAST_UPDATE_DATE:'KEY_LOCAL_LAST_UPDATE_DATE',CUSTOMER_SERVER_URL:'KEY_LOCAL_CUSTOMER_SERVER_URL',BEACON_STATE:'KEY_LOCAL_BEACON_STATE',IS_IN_BUILDEING:'KEY_LOCAL_IS_IN_BUILDING',SEAT_WILLING_CHECKIN:'KEY_SESSION_SEAT_WILLING_CHECKIN',SCAN_CONFIRM_CHECKIN:'KEY_SESSION_SCAN_CONFIRM_CHECKIN',FIRSTTIME_USE:'KEY_LOCAL_FIRSTTIME_USE'};var c={DEVICE_READY:'deviceready',CHECKIN_STATE_CHANGE:'checkin_state_change',BEACON_STATE_CHANGE:'beacon_state_change',UPDATE_SVG_STATUS:'update_svg_status'};var d={log:function(a){if(a==null)a='null';console.log("["+new Date()+"] "+a);}};var e=function(a){return function(b){var c=b[a.charAt(0).toLowerCase()+a.slice(1)];return{get:function(a){var b=c.getItem(a);if(!b||b==="null")return null;if(b.charAt(0)==="{"||b.charAt(0)==="[")return angular.fromJson(b);return b;},set:function(a,b){if(typeof b==="undefined")b=null;else if(angular.isObject(b)||angular.isArray(b))b=angular.toJson(b);c.setItem(a,b);},remove:function(a){c.removeItem(a);},clear:function(){c.clear();}};};};(function(){if(!String.prototype.endsWith)String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1;};})();var f={localStorage:e('LocalStorage')(a),IMG_REGEX:/.*\/(.+\.(jpg|png|gif|bmp|jpeg))/i,DEFAULT_PAGE_SIZE:20,getAthorizationKey:function(){return "sdfkihernvioerj";},isRunningOnPhonegap:function(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/);},isCordovaNotSupport:function(){try{return !cordova;}catch(a){return true;}},isIOS:function(){if(!a.device)return false;return device.platform.toLowerCase()=='ios';},isIbeaconSupported:function(){if(!a.device)return false;var b=device.platform.toLowerCase(),c=device.version;console.log('[util.js 110] platform: '+b);return b=='ios'||(b=='android'&&c>='4.3');},createLocalNotification:function(b){var c={id:+new Date()+"",title:"NS Werkplek",message:""};var d=_.isObject(b)?b:{"message":b};d=_.extend(c,d);a.plugin.notification.local.add(d);},toast:function(b,c){if(!a.plugins)return a.alert(b);var d={'duration':'short','position':'bottom'};var c=_.extend(d,c);a.plugins.toast.show(b,c.duration,c.position,function(a){console.log('Toast success:'+a);},function(a){console.log('Toast error:'+a);});},currUser:function(a){var c=b.CURR_USER;if(a)this.localStorage.set(c,a);else return this.localStorage.get(c);},clearCurrUser:function(){this.localStorage.remove(b.CURR_USER);},getUserData:function(a,c){if(!c){var e=this.currUser();if(!e){d.log('getUserData Error. Current user not exist.');return null;}c=e.email;}c=c.toLowerCase();var f=b.USER_DATA;var g=this.localStorage.get(f);if(!g)return null;else return g[c][a];},setUserData:function(a,c,e){if(!e){var f=this.currUser();if(!f){d.log('getUserData Error. Current user not exist.');throw 'getUserData Error. Current user not exist.';}e=f.email;}e=e.toLowerCase();var g=b.USER_DATA;var h=this.localStorage.get(g);if(!h)h={};userdata2=h[e];if(!userdata2)h[e]={};h[e][a]=c;this.localStorage.set(g,h);},clearAllUserData:function(){this.localStorage.remove(b.USER_DATA);},lastUpdateDate:function(a){var c=b.LAST_UPDATE_DATE;if(a)this.setUserData(c,a);else return this.getUserData(c);},getCustomerServerURL:function(a){var c=this.getUserData(b.CUSTOMER_SERVER_URL,a);if(c&&c.endsWith('/'))return c.substring(0,c.length-1);else return c;},setCustomerServerURL:function(a,c){this.setUserData(b.CUSTOMER_SERVER_URL,a,c);},getPictureRootUrl:function(){var a=this.getCustomerServerURL();if(a)return a.substring(0,a.length-3);else return null;},getBeaconStates:function(){return this.localStorage.get(b.BEACON_STATE);},setBeaconState:function(a,c){var d=b.BEACON_STATE;var e=f.getBeaconStates()||{};e[a]={'state':c,'ts':Date.now()};this.localStorage.set(d,e);},clearBeaconStates:function(){this.localStorage.remove(b.BEACON_STATE);},isInBuilding:function(a){if(a==undefined)return this.getUserData(b.IS_IN_BUILDEING);else this.setUserData(b.IS_IN_BUILDEING,a);},parseBarcode:function(a){if(!a)return null;a=a.trim().toLowerCase();var b=/hnw:\/\/\d{3}-\d{2}-\d{4}/;if(!b.test(a))return null;return{building:a.substring(6,9),floor:a.substring(10,12),seat:a.substring(13)};},normalizeAttrName:function(a){var b=/([\:\-\_]+(.))/g;var c=/^moz([A-Z])/;var d=/^((?:x|data)[\:\-_])/i;function e(a){return f(a.replace(d,''));}function f(a){return a.replace(b,function(a,b,c,d){return d?c.toUpperCase():c;}).replace(c,'Moz$1');}return e(a);},imgName:function(a){return a.replace(this.IMG_REGEX,'$1');},svgName:function(a){return a.replace(/.*\/(.+\.svg)/i,'$1');}};var g=(function(){var a={user:[['id','UserId'],['name',function(a){var b=[a.FirstName||'',a.MiddleName||'',a.LastName||''].join(' ');return b;}],['num','PersId'],['email','Email'],['photo','UserPic']]};var b=function(b,c){var d={},e=a[b];_.each(e,function(a){var b=a[1];var e=_.isFunction(b)?b(c):c[b];if(e!=undefined)d[a[0]]=e;});return d;};var c={};_.each(_.keys(a),function(a){c[a]=function(c){return b(a,c);};});return c;})();var h=function(a,b,c,d){this.uuid=a;this.identifier=b;this.major=c;this.minor=d;this.beaconRegion=this.createBeacon(a,b,c,d);this.events={'enter':[],'leave':[]};this.errorHandler=console.log;};h.prototype={createBeacon:function(a,b,c,d){var e=new cordova.plugins.locationManager.BeaconRegion(b,a,c,d);return e;},_createDelegate:function(){var a=this;var b=new cordova.plugins.locationManager.Delegate().implement({didDetermineStateForRegion:function(b){console.log('[ibeacon:'+a.uuid+']didDetermineStateForRegion: '+JSON.stringify(b));if(b.state=='CLRegionStateInside')_.each(a.events.enter,function(c){c.apply(a,[b]);});else if(b.state=='CLRegionStateOutside')_.each(a.events.leave,function(c){c.apply(a,[b]);});cordova.plugins.locationManager.appendToDeviceLog('[ibeacon:'+this.uuid+']didDetermineStateForRegion: '+JSON.stringify(b));},didStartMonitoringForRegion:function(a){console.log('[ibeacon:'+this.uuid+']didStartMonitoringForRegion:'+JSON.stringify(a));},didRangeBeaconsInRegion:function(a){console.log('[ibeacon:'+this.uuid+']didRangeBeaconsInRegion: '+JSON.stringify(a));}});return b;},addEventListener:function(a,b){this.events[a].push(b);},removeEventListener:function(a,b){var c=this.events[a].indexOf(b);this.events[a].splice(c,1);},startMonitoring:function(){var a=this._createDelegate();cordova.plugins.locationManager.setDelegate(a);cordova.plugins.locationManager.startMonitoringForRegion(this.beaconRegion).fail(this.errorHandler).done();},stopMonitoring:function(){cordova.plugins.locationManager.stopRangingBeaconsInRegion(this.beaconRegion).fail(this.errorHandler).done();}};var i=function(a){return{createBeacon:function(a,b,c,d){var e=new cordova.plugins.locationManager.BeaconRegion(b,a,c,d);return e;},createDelegate:function(){var b=new cordova.plugins.locationManager.Delegate().implement({didDetermineStateForRegion:function(b){console.log('[ibeacon]didDetermineStateForRegion: '+JSON.stringify(b));var c=b.state,d=b.region;var e=a.beaconmodel.beacons;var f=_.find(e,function(a){return a.uuid==d.uuid&&a.identifier==d.identifier&&a.major==d.major&&a.minor==d.minor;});if(f){console.log('beacon in range '+c);if(c=='CLRegionStateInside')f.stateChange(BEACON_IN_RANGE);else if(c=='CLRegionStateOutside')f.stateChange(BEACON_OUT_OF_RANGE);}cordova.plugins.locationManager.appendToDeviceLog('[ibeacon]didDetermineStateForRegion: '+JSON.stringify(b));},didStartMonitoringForRegion:function(a){console.log('[ibeacon]didStartMonitoringForRegion: '+JSON.stringify(a));},didRangeBeaconsInRegion:function(a){console.log('[ibeacon]didRangeBeaconsInRegion: '+JSON.stringify(a));}});return b;},createIosDelegate:function(){var b=new cordova.plugins.locationManager.Delegate().implement({didDetermineStateForRegion:function(a){console.log('[ibeacon]didDetermineStateForRegion: '+JSON.stringify(a));},didStartMonitoringForRegion:function(a){console.log('[ibeacon]didStartMonitoringForRegion: '+JSON.stringify(a));},didRangeBeaconsInRegion:function(b){console.log('[ibeacon]didRangeBeaconsInRegion: '+JSON.stringify(b));var c=b.beacons;var d=a.beaconmodel.beacons;_.each(d,function(a){var b=_.find(c,function(b){return a.uuid.toLowerCase()==b.uuid.toLowerCase()&&a.major==b.major&&a.minor==b.minor;});var d=a.state;if(b){if(d!=BEACON_IN_RANGE){console.log('beacon: '+a.major+' change state to '+BEACON_IN_RANGE);a.stateChange(BEACON_IN_RANGE);}}else if(d!=BEACON_OUT_OF_RANGE){console.log('beacon: '+a.major+' change state to '+BEACON_OUT_OF_RANGE);a.stateChange(BEACON_OUT_OF_RANGE);}});}});return b;}};};var j=angular.module("nhw.utils",[]);j.factory('Log',function(){return d;}).factory('Util',['$http','$q','Log',function(b,c,d){function e(a,e){var g=c.defer();b.get(a).success(function(a,b,c,d){if(a){if(e)a=e(a);g.resolve(a);}else g.resolve(null);}).error(function(b,c,e,h){f.toast('Er kon geen verbinding tot stand worden gebracht met de applicatie server.');d.log('[HTTPGET ERROR]: get '+a+' error.');d.log('[HTTPGET ERROR]: data: '+JSON.stringify(b)+'; status:'+JSON.stringify(c)+'; headers: '+JSON.stringify(e)+'; config:'+JSON.stringify(h));g.reject(b);});return g.promise;}function g(b,d){var e=c.defer();a.resolveLocalFileSystemURL(d,function(a){console.log(a.toURL()+' is exist. download cancel.');e.resolve(a.toURL());},function(a){if(a.code==1){console.log('download from '+b+' ...');var c=new FileTransfer();c.download(b,d,function(a){e.resolve(a.toURL());},function(a,b){console.log('error occured while downloading. '+a);console.log(JSON.stringify(b));e.reject(b);});}else{console.log('error occured when resolve local file url '+d+'. error code is '+a.code);e.reject(a);}});return e.promise;}var h=_.extend({httpget:e,download:g},f);return h;}]).factory('DataTransform',function(){return g;}).factory('BeaconUtil',['$rootScope',function(a){return i(a);}]);_.each(['LocalStorage','SessionStorage'],function(a){j.factory(a,['$window',e(a)]);});var k={"STORAGE_KEYS":b,"EVENTS":c,"Log":d,"WebStorage":e,"Util":f,"DataTransform":g,"SingleBeacon":h,"BeaconUtil":i};_.extend(a,k);})(window);;(function(a){var b={initialize:function(){this.bindEvents();},bindEvents:function(){document.addEventListener('deviceready',this.onDeviceReady,false);},onDeviceReady:function(){b.receivedEvent('deviceready');},receivedEvent:function(b){console.log('------ receive event -----');if(a.cordova.logger)try{a.cordova.logger.__onDeviceReady();}catch(c){}angular.element(document.body).scope().$emit('deviceready');}};a.app=b;})(window);;(function(a){var b={addSubscriber:function(a){this.subscribers[this.subscribers.length]=a;},removeSubscriber:function(a){for(var b=0;b<this.subscribers.length;b++)if(this.subscribers[b]===a)delete this.subscribers[b];},publish:function(a){for(var b=0;b<this.subscribers.length;b++)if(typeof this.subscribers[b]==='function')this.subscribers[b](a);},make:function(a){for(var b in this){a[b]=this[b];a.subscribers=[];}}};a.observer=b;})(window);angular.module('nhw',['ui.router','ngTouch','ngSanitize','mobile-angular-ui','ui.bootstrap','nhw.directives','nhw.filters','nhw.utils','nhw.services','nhw.controllers','nhw.beacon-model','nhw.test']).constant("_",window._).factory("Bootstrap",['$log','$rootScope','$q','$window','_','Util','Beacons','User','Floors','BeaconUtil','BeaconModel',function(a,b,c,d,e,f,g,h,i,j,k){function l(){if(!f.isIbeaconSupported())return;if(!f.getCustomerServerURL())return;var a={beacons:[],groups:[],rules:[]};var c={},d={};g.allBeacons().$promise.then(function(b){e.each(b,function(b){var d=new k.Beacon(b.IbeaconId,b.UUID,b.Name,b.Major,b.Minor);a.beacons.push(d);c[b.IbeaconId]=d;});g.allGroups().$promise.then(function(b){e.each(b,function(b){var f=(b.BeaconId+"").split(",");var g=e.map(f,function(a){return c[a];});var h=new k.BeaconGroup(b.GroupId,b.GroupNum,g);a.groups.push(h);d[b.GroupId]=h;});g.allRules().$promise.then(function(b){e.each(b,function(b){var c=new k.Rule(b.RuleId,d[b.From],d[b.To],b.Message,b.Type);a.rules.push(c);});var g=f.getBeaconStates();e.each(g,function(a,b){c[b].state=a.state;c[b].ts=a.ts;});console.log("Init beacon model complelted");m(a.rules);});});});b.beaconmodel=a;}function m(a){console.log('bind rules to beacon');e.each(a,function(a){e.each(a.from.beacons,function(b){b.addSubscriber(a.action.bind(a));console.log('beacon '+b+' add subscriber: '+a);});e.each(a.to.beacons,function(b){b.addSubscriber(a.action.bind(a));console.log('beacon '+b+' add subscriber: '+a);});});}function n(){if(!f.getCustomerServerURL())return;b.isInBuilding=f.isInBuilding();if(f.isIOS()){var a='Estimote Beacon',c='b9407f30-f5f8-466e-aff9-25556b57fe6d';var d=new cordova.plugins.locationManager.BeaconRegion(a,c);var h=j.createIosDelegate();cordova.plugins.locationManager.setDelegate(h);cordova.plugins.locationManager.startRangingBeaconsInRegion(d).fail(console.log).done();cordova.plugins.locationManager.startMonitoringForRegion(d).fail(console.log).done();return;}else g.allBeacons().$promise.then(function(a){var b=e.map(a,function(a){if(!a.Active)return null;return j.createBeacon(a.UUID,a.Name,a.Major,a.Minor);});var c=j.createDelegate();cordova.plugins.locationManager.setDelegate(c);e.each(b,function(a){if(a)cordova.plugins.locationManager.startMonitoringForRegion(a).fail(console.log).done();});});}function o(){console.log('check and enable bluetooth');if(!f.isIbeaconSupported()){Log.log('ibeacon is not supported on this device.');f.toast('ibeacon wordt niet ondersteund');return;}console.log('check and enable bluetooth 2.');try{if(!bluetoothle){Log.log('Bluetooth LE is not supported.');return;}}catch(a){return;}bluetoothle.isEnabled(function(a){if(!a.isEnabled)bluetoothle.initialize(function(a){var b=a.status;if(b=='enabled'){Log.log('Bluetooth enabled');n();}else Log.log('Bluetooth enable failed.');},Log.log,{'request':true});else n();});}function p(a){console.log('[ERROR] File api error.');console.log(JSON.stringify(a));}function q(){var c=d.device.platform.toLowerCase(),f=(c=='android'&&cordova.file.externalApplicationStorageDirectory)||(c=='ios'&&cordova.file.dataDirectory)||cordova.file.dataDirectory,g=f+'avatar/',h=[];a.log('[initCacheFiles] os:'+c+"; datadir: "+f+"; avatardir: "+g);b.DATADIR=f;b.AVATAR_DIR=g;b.SVG_DIR=f+'svg/';d.resolveLocalFileSystemURL(f,function(c){c.getDirectory('avatar',{create:true},function(c){var d=c.createReader();d.readEntries(function(c){e.each(c,function(a){h.push(a.name);});b.userpics=h;a.log('[initCacheFiles] userpics: '+JSON.stringify(h));},p);},p);},p);}function r(){if(!f.getCustomerServerURL()||!f.isRunningOnPhonegap())return;h.allUserPics().then(function(a){e.each(a,function(a){if(f.IMG_REGEX.test(a)){var c=f.imgName(a),d=b.picurl+a,g=b.AVATAR_DIR+c;if(!e.contains(b.userpics,c))f.download(d,g).then(function(a){b.userpics.push(c);});}});});}function s(){var a=c.defer();if(!f.getCustomerServerURL()||!f.isRunningOnPhonegap()){a.resolve(c.when(false));return a.promise;}i.allsvgfiles().then(function(d){var g=e.map(d,function(a){var c=f.svgName(a),d=b.picurl+a,e=b.SVG_DIR+c;return f.download(d,e);});a.resolve(c.all(g));});return a.promise;}function t(){console.log('preload offline files');if(!f.isRunningOnPhonegap())return;s();r();}function u(){l();o();q();t();}return{deviceready:u,checkAndEnableBluetooth:o,initBeaconModel:l,preloadSvgFiles:s,preloadUserPics:r};}]).run(['$rootScope','$state','$stateParams','$window','Util','Bootstrap','$modalStack','User',function(a,b,c,d,e,f,g,h){var i=e.currUser();(function(){if(i)if(i.Email||(i.email!==i.email.toLowerCase())||!i.num){e.clearCurrUser();e.clearAllUserData();}})();if(i)h.isAuthenticated(i).then(function(a){if(a)if(a.photo!==i.photo){i.photo=a.photo;e.currUser(i);}});a._=window._;a.cuser=i;a.picurl=e.getPictureRootUrl();a.$on('$locationChangeSuccess',function(){var a=g.getTop();while(a){g.dismiss(a.key,'$locationChangeSuccess');a=g.getTop();}});if(!e.isRunningOnPhonegap())a.isInBuilding=true;a.$on('deviceready',function(a){console.log('bootstrap');f.deviceready();});}]).config(['$stateProvider','$urlRouterProvider',function(a,b){a.state("home",{url:"/",templateUrl:"partials/loading.html",resolve:{authenticated:['User',function(a){return a.isAuthenticated();}],isCheckin:['User',function(a){return a.hasCheckIn();}]},controller:['$scope','$state','authenticated','isCheckin','User','Util',function(a,b,c,d,e,f){if(!c){b.go('app.welcome',{},{location:false});return;}if(d){var g=d;var h=g.FloorId,i=parseInt(g.SeatCode);b.go('app.index',{f:h,s:i},{location:false});}else b.go('app.checkin',{},{location:false});}]}).state("app",{url:"/app","abstract":true,templateUrl:"partials/main.html"}).state("app.welcome",{url:"/welcome",views:{"mainContent":{templateUrl:"partials/welcome.html"}}}).state("app.checkin",{url:"/checkin",views:{"mainContent":{templateUrl:"partials/checkin.html"}}}).state("app.index",{url:"/index?f&s",views:{"mainContent":{templateUrl:"partials/app-index.html"}}}).state("app.buildings",{url:"/buildings",views:{"subContent":{templateUrl:"partials/buildings.html"}}}).state("app.floors",{url:"/floors/:buildingId",views:{"subContent":{templateUrl:"partials/floors.html"}}}).state("app.floor_select",{url:"/floor/:f?s",views:{"subContent":{templateUrl:"partials/floor_select.html"}}}).state("app.profile",{url:"/profile/:uid",views:{"mainContent":{templateUrl:"partials/profile.html"}}}).state("app.colleague_profile",{url:"/collprofile/:uid",views:{"mainContent":{templateUrl:"partials/colleague_profile.html"}}}).state("app.employees",{url:"/employees?t",views:{"subContent":{templateUrl:"partials/employees.html"}}});b.otherwise('/');}]);var a=Util.normalizeAttrName;angular.module('nhw.directives',[]).directive('autoHeight',['$window','$timeout',function(a,b){return{link:function(c,d,e){var f,g;f=function(a){var b,c,d,e;b=0;for(d=0,e=a.length;d<e;d++){c=a[d];b+=c.offsetHeight;}return b;};g=function(a){var b,c,d,e,f;e=a.parent().children();f=[];for(c=0,d=e.length;c<d;c++){b=e[c];if(b!==a[0])f.push(b);}return f;};var h=function(){var b,c;b=e.additionalHeight||0;c=a.innerHeight-d.parent()[0].getBoundingClientRect().top;return d.css('height',(c-f(g(d))-b)+'px');};angular.element(a).bind('resize',h);h();return b(function(){console.log('auto-heigth trigger resize');return angular.element(a).triggerHandler('resize');},1000);}};}]).directive('stopEvent',function(){return{restrict:'A',link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation();});}};}).directive('btnLoading',function(){return{link:function(a,b,c){a.$watch(function(){return a.$eval(c.btnLoading);},function(a){if(a){b.addClass("disabled").attr("disabled","disabled");b.data('resetText',b.html());b.html(b.attr('data-loading'));}else{b.removeClass("disabled").removeAttr("disabled");b.html(b.data('resetText'));}});}};}).directive('nhwSrc',['$rootScope','_','Util',function(b,c,d){return{link:function(e,f,g){var h=a("nhwSrc");var i=/^file:\/\//g;var j=/.*\/(.+\.(jpg|png|gif|bmp|jpeg))/i;var k=function(a){return a.replace(j,'$1');};g.$observe(h,function(a){if(!a||!j.test(a)){g.$set("src","img/default_avatar.jpg");return;}if(!d.isRunningOnPhonegap()){g.$set("src",a);return;}if(i.test(a)){g.$set("src",a);return;}var e=k(a),f=b.AVATAR_DIR+e;if(c.contains(b.userpics,e))g.$set("src",f);else{var h=new FileTransfer();h.download(a,f,function(c){console.log('Download '+a+' successful. stored to '+f);b.userpics.push(e);g.$set("src",f);},function(b){console.log('ERROR: Download '+a+' failed.');console.log(JSON.stringify(b));g.$set("src",a);});}});}};}]).directive('popwin',['$window',function(a){return{link:function(b,c,d){var e=a.document.documentElement.offsetHeight;return c.css({'height':(e-200)+'px','overflow':'auto'});}};}]).directive('hidesidemenu',['$rootScope','$window',function(a,b){return{link:function(c,d,e){function f(){var c=b.innerWidth;if(c<980)return;var e=d.hasClass('has-sidebar-left'),f=d.hasClass('sidebar-left-in');if(!a.cuser){if(e)d.removeClass('has-sidebar-left');if(f)d.removeClass('sidebar-left-in');}else if(!e&&!f)d.addClass('has-sidebar-left');}angular.element(b).bind('resize',f);a.$watch('cuser',function(a,b){f();});}};}]).directive('infiniteScroll',["$window",function(a){return{link:function(a,b,c){var d=parseInt(c.threshold)||0;var e=b[0];b.bind('scroll',function(){if(a.$eval(c.canLoad)&&e.scrollTop+e.offsetHeight>=e.scrollHeight-d)a.$apply(c.infiniteScroll);});}};}]);;angular.module('nhw.filters',[]).filter('excludeId',['_',function(a){return function(b,c,d){return a.reject(b,function(a){return a[c]==d;});};}]);angular.module('nhw.services',['ngResource']).factory('User',['$resource','$http','$q','_','$rootScope','Util',function(a,b,c,d,e,f){return{baseurl:function(){return f.getCustomerServerURL()+'/api/user';},favouriteurl:function(){return f.getCustomerServerURL()+'/api/favorite';},isAuthenticated:function(a){var b=f.currUser();if(!a&&!b)return false;else if(!a&&b)a={name:b.name,email:b.email,num:b.num};var c=f.getCustomerServerURL(a.email)+'/api/user/checkuser/'+a.email+'/'+a.num;console.log(c);return f.httpget(c,DataTransform.user);},hasCheckIn:function(a){var b;if(!a){var c=e.cuser;if(!c)return false;b=c.id;}else b=a;var d=this.baseurl()+'/ischeckin/'+b;return f.httpget(d);},all:function(){return a(this.baseurl()+"/:id").query();},findById:function(b){return a(this.baseurl()+"/:id").get({id:b});},checkout:function(){var a=f.currUser();return b.put(this.baseurl()+'/checkout/'+a.id);},favourites:function(b,c){var d=f.currUser();if(!b)return a(this.baseurl()+'/favorite/:id',{id:'@id'}).query({id:d.id});var e=this.baseurl()+'/favorite/'+([d.id,f.DEFAULT_PAGE_SIZE,b,c].join('/'));return f.httpget(e);},allWithFavourites:function(b,c){var d=f.currUser();if(!b)return a(this.baseurl()+'/withfavorite/:id',{id:'@id'}).query({id:d.id});var e=this.baseurl()+'/withfavorite/'+([d.id,f.DEFAULT_PAGE_SIZE,b,c].join('/'));return f.httpget(e);},checkins:function(b,c){var d=f.currUser();if(!b)return a(this.baseurl()+'/online/:id',{id:'@id'}).query({id:d.id});var e=this.baseurl()+'/online/'+([d.id,f.DEFAULT_PAGE_SIZE,b,c].join('/'));return f.httpget(e);},addFavourite:function(a){var c=f.currUser();b.post(this.favouriteurl()+'/add/'+c.id+'/'+a);},cancelFavourite:function(a){var c=f.currUser();b['delete'](this.favouriteurl()+'/cancel/'+c.id+'/'+a);},favoriteCount:function(a){return f.httpget(this.favouriteurl()+'/count/'+a);},isFavourite:function(a){var b=f.currUser();return f.httpget(this.favouriteurl()+'/isfavorite/'+b.id+'/'+a);},notCheckins:function(b,c){var d=f.currUser();if(!b)return a(this.baseurl()+'/offline/:id',{id:'@id'}).query({id:d.id});var e=this.baseurl()+'/offline/'+([d.id,f.DEFAULT_PAGE_SIZE,b,c].join('/'));return f.httpget(e);},setUserState:function(a){var c=f.currUser(),d=this.baseurl()+'/setuserstatus/'+c.id+'/'+a;return b.put(d);},allUserPics:function(){var a=this.baseurl()+'/alluserpic';return f.httpget(a);},incrementalUpdate:function(a){return f.httpget(this.baseurl()+'/incremental/'+a);}};}]).factory('Building',['$resource','$q','_','Util',function(a,b,c,d){return{baseurl:function(){return d.getCustomerServerURL()+'/api/building';},all:function(){return a(this.baseurl()+'/:id').query();},seatCount:function(a){return d.httpget(this.baseurl()+'/count/'+a);},incrementalUpdate:function(a){return d.httpget(this.baseurl()+'/incremental/'+a);}};}]).factory('Floors',['$resource','$http','$q','_','Util',function(a,b,c,d,e){return{baseurl:function(){return e.getCustomerServerURL()+'/api/floor';},seaturl:function(){return e.getCustomerServerURL()+'/api/seat';},all:function(){return a(this.baseurl()+'/:id').query();},floorsByBuildingId:function(b){return a(this.baseurl()+'/building/:buildingId').query({buildingId:b});},findById:function(b){return a(this.baseurl()+'/:id').get({id:b});},findByBuildingNoAndFloorNo:function(b,c){return a(this.baseurl()+'/:buildno/:floorno').get({buildno:b,floorno:c});},getUnAvailableSeatsByFloor:function(a){var b=this.baseurl()+'/unavailableseat/'+a;return e.httpget(b,function(a){var b=a.FloorSeats;var c=d.map(b,function(a){return{'seat':parseInt(a.SeatCode),'userId':a.UserId};});return c;});},checkin:function(a,c){var d=e.currUser();var f=this.seaturl()+'/checkin/'+a+'/'+c+'/'+d.id;return b.put(f);},reserveseat:function(a){var b=this.seaturl()+'/reserveraseat/'+a;return e.httpget(b);},allsvgfiles:function(){var a=this.baseurl()+'/allsvgfile';return e.httpget(a);},incrementalUpdate:function(a){return e.httpget(this.baseurl()+'/incremental/'+a);}};}]).factory('Beacons',['$resource','$q','$http','$rootScope','_',function(a,b,c,d,e){var f=a('js/data/beacons.json');return{baseurl:function(){return Util.getCustomerServerURL()+'/api/ibeacon';},allBeacons:function(){return a(this.baseurl()+'/:id').query();},allGroups:function(){return a(this.baseurl()+'/group').query();},allRules:function(){return a(this.baseurl()+'/rules').query();},logRuleTrigger:function(a){return c.post(this.baseurl()+'/userpassinandout/'+d.cuser.id+'/'+a);},incrementalUpdate:function(a){return Util.httpget(this.baseurl()+'/incremental/'+a);}};}]).factory('LicenseServer',['$resource','$http','$q','Util',function(a,b,c,d){var e="http://www.hongding.nl";return{getCustomerServerURL:function(a){var b=e+'/api/customer/CheckLicense/'+a;return d.httpget(b,function(a){return a.ServerUrl;});}};}]).factory('CtrlService',['$rootScope','$state','$modal','$log','User',function(a,b,c,d,e){function f(){e.checkout().then(function(c){if(c){b.go("app.checkin");a.$broadcast(EVENTS.CHECKIN_STATE_CHANGE);console.log('toggle mainSidebar off');}else console.log("user checkout failed");});}function g(){var a=c.open({templateUrl:'confirm_checkout_modal.html',controller:'CheckInModalCtrl',windowClass:'mymodal',size:'sm',resolve:{data:function(){return{};}}});a.result.then(function(a){if(a)f();},function(){d.info('Modal dismissed at: '+new Date());});}function h(a,b){if(b)e.cancelFavourite(a);else e.addFavourite(a);}return{checkout:f,checkout_confirm:g,toggle_favourite:h};}]).factory('SVG',['$rootScope','$window','$q','Floors','Util',function(a,b,c,d,e){var f=function(a){return a.replace(/.*\/(.+\.svg)/i,'$1');};var g=function(){var a=document.getElementById("svg-wrapper"),c=a.currentStyle||b.getComputedStyle(a);return{"w":a.offsetWidth,"h":a.offsetHeight-(parseInt(c.paddingBottom,10)+parseInt(c.paddingTop,10))};};var h={top:-5,right:-5,bottom:-5,left:-5};function i(a,b){this.floorId=a;this.seat=b;var c=g();this.width=c.w;this.height=c.h;this.zoom=d3.behavior.zoom().scaleExtent([1,10]).on('zoomstart',this.zoomstarted.bind(this)).on('zoom',this.zoomed.bind(this)).on('zoomend',this.zoomended.bind(this));this.svg=d3.select("#svg-wrapper").append("svg").attr("width",this.width+h.left+h.right).attr("height",this.height+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.right+")").call(this.zoom);this.rect=this.svg.append("rect").attr('width',this.width).attr('height',this.height).style('fill','none').style('pointer-events','all');this.container=this.svg.append('g');this.bind_resize();}i.prototype={zoomstarted:function(){d3.event.sourceEvent&&d3.event.sourceEvent.stopPropagation();},zoomended:function(){},zoomed:function(){this.container.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")");},_load_svg:function(a,b){var c=this;d3.xml(a,'image/svg+xml',function(a){c.innersvg=c.container.append('g').append(function(){return a.documentElement;});b&&b();});},load:function(){var b=c.defer();var g=this;var h=function(){b.resolve(g);};d.findById(g.floorId).$promise.then(function(b){g.floor=b;var c=a.picurl+b.SvgFile;if(!e.isRunningOnPhonegap()){g._load_svg('img/map.svg',h);return;}var d=f(b.SvgFile),i=a.SVG_DIR+d;e.download(c,i).then(function(a){g._load_svg(a,h);},function(a){g._load_svg(c,h);});},function(a){b.reject(a);});return b.promise;},init_seat_state:function(){var a=this;this.innersvg.selectAll("[id^='circle']").classed('seat-available',true);d.getUnAvailableSeatsByFloor(this.floorId).then(function(b){var c={"seat-available":false,"seat-unavailable":true};_.each(b,function(b){var d=a.innersvg.select("#circle"+b.seat);d.classed(c).attr("data-user",b.userId);});});},reset_seat_state:function(){this.innersvg.selectAll("[id^='circle'][data-user]").classed({"seat-available":false,"seat-unavailable":false,"seat-cuser":false}).attr("data-user",null);},bind_event:function(a){this.innersvg.selectAll("[id^='circle']").on("click",function(b,c){a(this);});},bind_resize:function(){var a=this;angular.element(b).bind('resize',function(){var b=g();a.width=b.w;a.height=b.h;d3.select("#svg-wrapper").select("svg").attr({'width':a.width+h.left+h.right,'height':a.height+h.top+h.bottom}).select('rect').attr({'width':a.width,'height':a.height});});},center_map:function(){if(this.seat){var a=this.innersvg.select("#circle"+this.seat);var b=a.attr("cx"),c=a.attr("cy");var d=(b>=this.width)?-(b-this.width/2):0,e=(c>=this.height)?-(c-this.height/2):0;this.zoom.translate([d,e]).event(this.svg);}},wrapper_size:function(){var a=document.getElementById("svg-wrapper"),c=a.currentStyle||b.getComputedStyle(a);return{"w":a.offsetWidth,"h":a.offsetHeight-(parseInt(c.paddingBottom,10)+parseInt(c.paddingTop,10))};}};return i;}]);angular.module("nhw.controllers",['nhw.services']).controller('LoginCtrl',['$scope','$rootScope','$state','User','LicenseServer','Util','Bootstrap',function(a,b,c,d,e,f,g){var h=function(){a.error="U bent niet geautoriseerd om gebruik te maken van deze applicatie.";a.loading=false;};a.login=function(i){a.loading=true;e.getCustomerServerURL(i.authKey).then(function(e){if(e){f.setCustomerServerURL(e,i.email);d.isAuthenticated(i).then(function(e){if(e){a.error="";b.cuser=e;e.email=e.email.toLowerCase();f.currUser(e);b.picurl=f.getPictureRootUrl();console.log('when login, start check and enable bluetooth');g.initBeaconModel();g.checkAndEnableBluetooth();g.preloadSvgFiles().then(function(){a.loading=false;d.hasCheckIn().then(function(a){if(a){var d=a.FloorId,e=parseInt(a.SeatCode);c.go('app.index',{f:d,s:e},{location:false});b.$broadcast(EVENTS.CHECKIN_STATE_CHANGE);}else c.go('app.checkin');},h);g.preloadUserPics();});}else h();},h);}else h();},h);};}]).controller('LoadingCtrl',['$scope',function(a){}]).controller('SidebarCtrl',['$scope','CtrlService','User',function(a,b,c){var d=function(){var b=c.hasCheckIn();if(b)b.then(function(b){a.hascheckin=!!b;});};d();a.$on(EVENTS.CHECKIN_STATE_CHANGE,d);a.checkout_confirm=b.checkout_confirm;}]).controller('NavCtrl',['$scope','$state','$modal','$log','User','Util','CtrlService',function(a,b,c,d,e,f,g){var h=function(){var b=e.hasCheckIn();if(b)b.then(function(b){a.hascheckin=!!b;});};h();a.$on(EVENTS.CHECKIN_STATE_CHANGE,h);a.checkout_confirm=g.checkout_confirm;}]).controller('CheckInCtrl',['$scope','$state','$sce','$modal','$log','$window','Util','Floors',function(a,b,c,d,e,f,g,h){a.scanBarcode=function(){if(g.isCordovaNotSupport()){h.all().$promise.then(function(a){var c=a[0].FloorId;h.reserveseat(c).then(function(a){var d=parseInt(a);var e={f:c,s:d};b.go('app.floor_select',e,{location:false});});});return;}cordova.plugins.barcodeScanner.scan(function(d){var e=d.text;var f=g.parseBarcode(e);if(!f){var i='De QR code is niet geldig.<br>';a.$apply(function(){a.error=c.trustAsHtml(i);});}else h.findByBuildingNoAndFloorNo(f.building,f.floor).$promise.then(function(a){b.go('app.floor_select',{f:a.FloorId,s:f.seat},{location:false});});},function(b){a.$apply(function(){a.error=c.trustAsHtml(b);});});};a.showRuleScreen=function(){var a=d.open({templateUrl:'firstuse_modal.html',controller:'CheckInModalCtrl',windowClass:'mymodal',size:'sm',resolve:{data:function(){return{};}}});a.result.then(function(a){},function(){e.info('Modal dismissed at: '+new Date());});};}]).controller('AppIndexCtrl',['$scope','$rootScope','$state','$stateParams','Util','Floors','User',function(a,b,c,d,e,f,g){var h=d.f,i=d.s;a.floor=f.findById(h);a.seat=i;a.checkout=function(){g.checkout().then(function(a){if(a){c.go("app.checkin");b.$broadcast(EVENTS.CHECKIN_STATE_CHANGE);}else console.log("user checkout failed");});};a.reflush=function(){b.$broadcast(EVENTS.UPDATE_SVG_STATUS);};}]).controller('BuildingsCtrl',['$scope','$state','$stateParams','Building',function(a,b,c,d){a.buildings=d.all();}]).controller('FloorsCtrl',['$scope','$state','$stateParams','Floors','Building',function(a,b,c,d,e){var f=c.buildingId;a.floors=d.floorsByBuildingId(f);e.seatCount(f).then(function(b){a.countInfo=b;});a.auto_reserve=function(a,c){if(c<=0)return;d.reserveseat(a).then(function(c){var d=parseInt(c);b.go('app.floor_select',{'f':a,'s':d},{location:false});});};}]).controller('FloorSelectCtrl',['$scope','$state','$stateParams','Floors','$window','User',function(a,b,c,d,e,f){var g=c.f,h=c.s;if(h)a.confirm_checkin=true;d.findById(g).$promise.then(function(b){b.free=b.SeatCount-b.NonEmptySeat;a.floor=b;});a.auto_reserve=function(a){d.reserveseat(a).then(function(c){if(c){var d=parseInt(c);b.go('app.floor_select',{'f':a,'s':d},{location:false,reload:true});}});};}]).controller('SvgCtrl',['$scope','$rootScope','$stateParams','Floors','$window','User','$modal','$log','$state','Util','SVG','CtrlService',function(a,b,c,d,e,f,g,h,i,j,k,l){var m=c.f,n=c.s,o=a.$parent.confirm_checkin;var p=b.cuser;var q=false;d.findById(m).$promise.then(function(b){a.floor=b;if(o){a.seat=n;a.confirm_checkin();}});var r=new k(m,n);r.load().then(function(){u(function(){q=true;r.center_map();});r.bind_event(function(c){var d=d3.select(c);var e=d.attr("id").substring(6);var g=d3.mouse(c);a.seat=e;var h=d.attr("data-user");if(h){f.findById(h).$promise.then(function(b){a.user=b;});f.isFavourite(h).then(function(b){a.isFavourited=b;});}var i=(d.classed('seat-cuser')||d.classed('seat-unavailable'))?"user":(q&&b.isInBuilding?"seat_change":"workspace");a.$apply(function(){a.popup=i;});var j=d3.select("#"+i+"_popup");var k=t(j.node(),g);j.style({left:k[0]+'px',top:k[1]+'px'});s();if(d.classed('seat-available')){a.last_selected_seat=d;d.classed({'seat-available':false,'seat-seleted':true});}});});function s(){if(a.last_selected_seat)a.last_selected_seat.classed({'seat-available':true,'seat-seleted':false});}a.close_popup=function(){s();a.popup=false;};function t(a,b){var c=r.wrapper_size(),d=c.w,e=c.h,f=a.offsetWidth,g=a.offsetHeight,h=b[0],i=b[1];if(i+g>e)i=(e-g)/2;if(h+f>d)h=(d-f)/2;return [h,i];}a.confirm_checkin=function(){a.popup=false;var b=g.open({templateUrl:'checkin_modal.html',controller:'CheckInModalCtrl',windowClass:'mymodal',size:'sm',resolve:{data:function(){return{floor:a.floor,seat:a.seat};}}});b.result.then(function(b){var c=a.seat;var e={'f':m,'s':c};d.checkin(m,c).then(function(a){if(a)i.go("home");else{}});},function(){h.info('Modal dismissed at: '+new Date());});};a.toggle_favourite=l.toggle_favourite;function u(a){r.init_seat_state();f.hasCheckIn().then(function(b){if(b){var c=r.innersvg.select("#circle"+parseInt(b.SeatCode));var d={"seat-available":false,"seat-unavailable":false,"seat-cuser":true};c.classed(d).attr("data-user",p.id);a&&a();}});}a.$on(EVENTS.UPDATE_SVG_STATUS,function(a){r.reset_seat_state();u();});}]).controller('CheckInModalCtrl',['$scope','$modalInstance','Util','data',function(a,b,c,d){a.data=d;a.ok=function(a){b.close(a);};a.cancel=function(){b.dismiss('cancel');};}]).controller('ProfileCtrl',['$scope','$stateParams','$rootScope','$window','User','Util','SVG','CtrlService',function(a,b,c,d,e,f,g,h){var i=b.uid;a.user=e.findById(i);a.iscuser=i==c.cuser.id;e.favoriteCount(i).then(function(b){a.favourite_count=b||0;});e.isFavourite(i).then(function(b){a.isFavourited=b;});e.hasCheckIn(i).then(function(b){a.checkinInfo=b;if(b){var c=new g(b.FloorId,parseInt(b.SeatCode));c.load().then(function(b){b.init_seat_state();var c={"seat-available":false,"seat-unavailable":false};if(a.iscuser)c["seat-cuser"]=true;else c["seat-me"]=true;var e=b.innersvg.select("#circle"+b.seat);e.classed(c).attr("data-user",i);angular.element(d).triggerHandler('resize');b.center_map();});}});a.toggle_favourite=h.toggle_favourite;a.back=function(){d.history.back();};a.updateUserState=function(a){e.setUserState(a);};}]).controller('ColleagueProfileCtrl',['$scope','$stateParams','$rootScope','$window','User','Util','SVG','CtrlService',function(a,b,c,d,e,f,g,h){var i=b.uid;a.user=e.findById(i);a.iscuser=i==c.cuser.id;e.favoriteCount(i).then(function(b){a.favourite_count=b||0;});e.isFavourite(i).then(function(b){a.isFavourited=b;});e.hasCheckIn(i).then(function(b){a.checkinInfo=b;if(b){var c=new g(b.FloorId,parseInt(b.SeatCode));c.load().then(function(b){b.init_seat_state();var c={"seat-available":false,"seat-unavailable":false};if(a.iscuser)c["seat-cuser"]=true;else c["seat-me"]=true;var e=b.innersvg.select("#circle"+b.seat);e.classed(c).attr("data-user",i);angular.element(d).triggerHandler('resize');b.center_map();});}});a.toggle_favourite=h.toggle_favourite;a.back=function(){d.history.back();};a.updateUserState=function(a){e.setUserState(a);};}]).controller('EmployeesCtrl',['$scope','$state','$stateParams','Util','User','CtrlService',function(a,b,c,d,e,f){a.type=c.t||'all';a.toggle_favourite=f.toggle_favourite;var g={'all':e.allWithFavourites,'favourite':e.favourites,'checkin':e.checkins,'notcheckin':e.notCheckins};var h=1,i=1;a.canLoad=false;a.loading=false;function j(a){return Math.floor(a/d.DEFAULT_PAGE_SIZE)+(a%d.DEFAULT_PAGE_SIZE==0?0:1);}a.$watchGroup(['type','q'],function(){h=1;g[a.type].call(e,h,a.q).then(function(b){a.employees=b.UserList;i=j(b.Count);a.canLoad=h<i;});});a.loadMore=function(){if(!a.loading){a.loading=true;h++;a.canLoad=h<i;g[a.type].call(e,h,a.q).then(function(b){a.employees=a.employees.concat(b.UserList);a.loading=false;});}};}]);;BEACON_IN_RANGE=1;BEACON_OUT_OF_RANGE=2;RULE_TYPE_Enter=1;RULE_TYPE_Exit=2;angular.module('nhw.beacon-model',[]).factory('BeaconModel',['$rootScope','Util','Beacons',function(a,b,c){function d(a,b,c,d,e){this.id=a;this.uuid=b;this.identifier=c;this.major=d;this.minor=e;this.state=null;this.ts=0;observer.make(this);}d.prototype={stateChange:function(a){this.state=a;this.ts=Date.now();this.publish(this);b.setBeaconState(this.id,a);},toString:function(){var a=[];a.push("[object Beacon]");a.push("["+this.id+"]");a.push("["+this.identifier+"]");a.push("["+this.major+"]");a.push("["+this.minor+"]");return a.join("");}};function e(a,b,c){this.id=a;this.num=b;this.beacons=c||[];}e.prototype={addBeacon:function(a){this.beacons.push(a);},removeBeacon:function(a){var b=this.beacons.indexOf(a);this.beacons.splice(b,1);},toString:function(){return "[object BeaconGroup]["+this.id+"]";},lastUpdateBeacon:function(){if(this.beacons.length==0)return null;else if(this.beacons.length==1)return this.beacons[0];var a=_.max(this.beacons,function(a){return a.ts;});return a;}};function f(a,b,c,d,e){this.id=a;this.from=b;this.to=c;this.message=d;this.type=e;}f.THRESHOLD=20*60*1000;f.prototype={action:function(d){console.log(this+' action. Fired by '+d);if(!this.isBeaconInRule(d))return;if(this.isRuleTrigger()){console.log("[Rule "+this.id+" trigger] Push Notification: "+this.message);b.createLocalNotification(this.message);c.logRuleTrigger(this.id);if(this.type==RULE_TYPE_Enter){b.isInBuilding(true);a.isInBuilding=true;}else if(this.type==RULE_TYPE_Exit){b.isInBuilding(false);a.isInBuilding=false;}}},toString:function(){return "[object Rule]["+this.id+"]";},isBeaconInRule:function(a){var b=this.from.beacons;b=b.concat(this.to.beacons);return _.contains(b,a);},isRuleTrigger:function(){var a=this.from.lastUpdateBeacon(),b=this.to.lastUpdateBeacon();if(b.ts-a.ts>0&&b.ts-a.ts<f.THRESHOLD)if((a.state==BEACON_OUT_OF_RANGE&&b.state==BEACON_IN_RANGE)||(a.state==BEACON_IN_RANGE&&b.state==BEACON_IN_RANGE)||(a.state==BEACON_OUT_OF_RANGE&&b.state==BEACON_OUT_OF_RANGE))return true;return false;}};return{Beacon:d,BeaconGroup:e,Rule:f};}]);angular.module("nhw.test",["nhw.services"]).config(['$stateProvider','$urlRouterProvider',function(a,b){a.state("test",{url:"/test","abstract":true,templateUrl:"partials/test/test.html"}).state("test.navigation",{url:"",views:{"testContent":{templateUrl:"partials/test/navigation.html"}}}).state("test.fns",{url:"/fn",views:{"testContent":{templateUrl:"partials/test/functions.html"}}}).state("test.quicktest",{url:"/quicktest",views:{"testContent":{templateUrl:"partials/test/quicktest.html"}}}).state("test.plugintest",{url:"/plugintest",views:{"testContent":{templateUrl:"partials/test/plugintest.html"}}}).state("test.apitest",{url:"/apitest",views:{"testContent":{templateUrl:"partials/test/apitest.html"}}});}]).controller('TestNavCtrl',['$scope',function(a){a.navs=[{name:"Login page",sref:"welcome"},{name:"Checkin page",sref:"app.checkin"},{name:"After checkin",sref:"app.index"},{name:"Plugin Test",sref:"test.plugintest"},{name:"API Test",sref:"test.apitest"}];}]).controller('TestFnCtrl',['$scope','$state','$window','Util',function(a,b,c,d){a.logout=function(){d.clearCurrUser();b.go('home',{},{location:'replace'});};}]).controller('QuickTestCtrl',['$scope',function(a){}]).controller('StorageTestCtrl',['$scope','LocalStorage','SessionStorage',function(a,b,c){var d='STORAGE_TEST_KEY';a.save=function(){b.set(d,a.localtext);c.set(d,a.sessiontext);};a.clear=function(){b.clear();c.clear();};var e=b.get(d)||'not values set',f=c.get(d)||'not values set';a.msg="localStorage: "+e+" -- sessionStorage: "+f;}]).controller('ModalInstanceCtrl',['$scope','$modalInstance','items',function(a,b,c){a.items=c;a.selected={item:a.items[0]};a.ok=function(){b.close(a.selected.item);};a.cancel=function(){b.dismiss('cancel');};}]).controller('ModalTestCtrl',['$scope','$modal','$log',function(a,b,c){a.items=['item1','item2','item3'];a.open=function(d){var e=b.open({templateUrl:'myModalContent.html',controller:'ModalInstanceCtrl',size:d,resolve:{items:function(){return a.items;}}});e.result.then(function(b){a.selected=b;},function(){c.info('Modal dismissed at: '+new Date());});};}]).controller('IBeaconTestCtrl',['$scope','Util',function(a,b){a.beacon={};a.beacon.uuid="b9407f30-f5f8-466e-aff9-25556b57fe6d";a.beacon.identifier="Estimote Beacon";a.beacon.major="58877";a.beacon.minor="52730";function c(a,b,c,d){var e=new cordova.plugins.locationManager.BeaconRegion(a,b,c,d);return e;}var d=function(a){b.createLocalNotification(a);};var e=new cordova.plugins.locationManager.Delegate().implement({didDetermineStateForRegion:function(a){d('[DOM] didDetermineStateForRegion: '+JSON.stringify(a));cordova.plugins.locationManager.appendToDeviceLog('[DOM] didDetermineStateForRegion: '+JSON.stringify(a));},didStartMonitoringForRegion:function(a){d('didStartMonitoringForRegion:',a);d('didStartMonitoringForRegion:'+JSON.stringify(a));},didRangeBeaconsInRegion:function(a){d('[DOM] didRangeBeaconsInRegion: '+JSON.stringify(a));}});var f=c(a.beacon.identifier,a.beacon.uuid,a.beacon.major,a.beacon.minor);a.startMonitoringSingleBeacon=function(){cordova.plugins.locationManager.setDelegate(e);cordova.plugins.locationManager.startMonitoringForRegion(f).fail(d).done();};a.stopMonitoringSingleBeacon=function(){cordova.plugins.locationManager.stopRangingBeaconsInRegion(f).fail(d).done();};a.testWriteMsg=function(){d(Math.round(Math.random()*100));};}]).controller('NotificationTestCtrl',['$scope','Util',function(a,b){a.notify1=function(){b.createLocalNotification('sample message');};a.notify2=function(){b.createLocalNotification({"id":"ID","message":"sample message2"});};}]).controller('BluetoothleTestCtrl',['$scope',function(a){function b(a){console.log(a);}function c(a){b('Bluetooth request failded. type: '+a.error+" error msg: "+a.message);}a.leIsEnabled=function(){bluetoothle.isEnabled(function(a){b('Bluetooth is'+a?' ':' not '+"enabled");});};a.leIsInitialize=function(){bluetoothle.isInitialized(function(a){var c=a.isInitialized;b('Bluetooth is'+c?' ':' not '+"initialize");});};a.leInitialize=function(){bluetoothle.initialize(function(a){var c=a.status=='enabled';if(c)b('Bluetooth initialize successful');else b('Bluetooth initialize failed. status: '+a.status);},c,{'request':true});};a.leStartScan=function(){bluetoothle.startScan(function(a){var c=a.status;if(c=='scanStarted')b('Bluetooth scan started ...');else if(c=='scanResult')b('Find device '+a.name+', address: '+a.address);else b("Bluetooth successful callback");},c,null);};a.leStopScan=function(){bluetoothle.stopScan(function(a){var c=a.status;if(c=='scanStopped')b('Bluetooth scan stopped');else b('Bluetooth stopScan callback');},c);};a.leClose=function(){bluetoothle.close(function(a){var c=a.status;if(c=='closed')b('Bluetooth closed.');else b('bluetooth close callback');},c);};}]).controller('APITestCtrl',['$scope','$log','$sce','LicenseServer','User',function(a,b,c,d,e){a.licenseKey='1234567';a.getLicenseServerUrl=function(){d.getCustomerServerURL(a.licenseKey).then(function(c){b.log(c);if(c)a.result=c.ServerUrl;});};a.user_all=function(){e.all().then(function(c){b.log(c);a.result=c;});};a.user_by_id=function(){e.findById(a.user.id).then(function(c){b.log(c);a.result=c;});};}]).controller('FileDownloadTestCtrl',['$scope','$rootScope','$window','Floors',function(a,b,c,d){var e=function(a){return a.replace(/.*\/(.+\.svg)/ig,'$1');};function f(a){console.log('ERROR. Error information as belows: ');console.log(JSON.stringify(a));}a.download=function(){d.all().$promise.then(function(a){var b=a[0];var d=e(b.SvgFile),g=cordova.file.externalApplicationStorageDirectory+d;console.log('File download test: '+g);c.resolveLocalFileSystemURL(g,function(a){console.log('Found file :'+JSON.stringify(a));console.log('file url is '+a.toURL());},function(a){console.log('ERROR: ');console.log(a);if(a.code==1){var c='https://www.nweapp.nl/hnw',d=c+b.SvgFile;console.log('File not exist. Download file from '+d);var e=new FileTransfer();e.download(d,g,function(a){console.log("File download successful. local url is "+a.toURL());},f);}});});};}]);